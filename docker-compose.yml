version: "2.1"
services:
  samba:
    image: stanback/alpine-samba:latest
    container_name: samba
    privileged: true
    volumes:
      - ${PWD}/conf/smb.conf:/etc/samba/smb.conf
      - /home/delta/:/share
      - ${PWD}/conf/smb-init.sh:/smb-init.sh
    ports:
      - 10.69.69.3:445:445
    restart: always
    entrypoint:
      - /smb-init.sh
  blog:
    image: algernon/writefreely:latest
    container_name: blog
    environment:
      - WRITEFREELY_BIND_HOST=blog.cameronseid.com
      - WRITEFREELY_BIND_PORT=7000
      - WRITEFREELY_SINGLE_USER=true
    volumes:
      - blog_data:/data
      - ${PWD}/conf/blog.ini:/data/config.ini
    ports:
      - 7000:8080
    restart: always
  caddy:
    image: abiosoft/caddy:no-stats
    container_name: caddy
    restart: always
    depends_on:
      - "blog"
    environment:
      - ACME_AGREE=true
    ports:
      - 80:80
      - 443:443
    volumes:
      - ${PWD}/conf/Caddyfile:/etc/Caddyfile
      - caddy_data:/root/.caddy
      - /home/delta/web:/srv
      - /home/delta/web/floof.zone/files/dj:/srv/deltaryz.com/mixes
      - /home/delta/win10:/srv/floof.zone/files/os/win10
  snapdrop:
    image: "node:lts-alpine"
    container_name: "snapdrop"
    depends_on:
      - "caddy"
    user: "node"
    restart: always
    working_dir: /home/node/app
    volumes:
      - ./snapdrop/:/home/node/app
    command: ash -c "npm i && node index.js"
    ports:
      - "3000:3000"

volumes:
  caddy_data:
  caddy_config:
  blog_data:
